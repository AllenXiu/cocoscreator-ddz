{"version":3,"sources":["ShowPoker.js"],"names":["POSITION_UP","POSITION_DOWN","cc","Class","extends","Component","properties","canTouch","_pokerSpriteList","_touchStart","_touchMove","onLoad","console","log","node","on","startCallback","endCallback","moveCallback","onDestroy","off","Node","EventType","TOUCH_START","TOUCH_END","TOUCH_MOVE","desTroyPokers","cards","length","pokerSprite","destroy","start","showPokers","type","startx","i","push","addChild","gap","scale","x","setPosition","pokerAllDown","status","y","isChiose","color","Global","selectPokers","_getCardForTouch","touch","box","getBoundingBoxToWorld","rectContainsPoint","_checkSelectCardReserve","touchBegan","touchMoved","p1","sprite","width","Math","abs","height","rect","rectIntersectsRect","event","touches","getTouches","touchLoc","getLocation","convertToNodeSpace","index","k","selectPoker","selectCard","getComponent","card","_imageName","splice"],"mappings":"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","file":"ShowPoker.js","sourceRoot":"../../../../assets/Script","sourcesContent":["const POSITION_UP = 1;\nconst POSITION_DOWN = 2;\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        canTouch: false,\n        _pokerSpriteList: null,\n        _touchStart: null,\n        _touchMove: null,\n    },\n\n    // use this for initialization\n    onLoad() {\n        console.log('mynode on load.');\n        //只有用户手牌允许点击\n        if (this.canTouch) {\n            this.node.on('touchstart', this.startCallback, this);\n            this.node.on('touchend', this.endCallback, this);\n            this.node.on('touchmove', this.moveCallback, this);\n        }\n        this._pokerSpriteList = [];\n    },\n\n    onDestroy() {\n        this.node.off(cc.Node.EventType.TOUCH_START, this.startCallback, this);\n        this.node.off(cc.Node.EventType.TOUCH_END, this.endCallback, this);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.moveCallback, this);\n    },\n    //销毁Poker\n    desTroyPokers(cards){\n        if (cards.length == 0) {\n            cards = this._pokerSpriteList;\n        }\n        for (const pokerSprite of cards) {\n            pokerSprite.destroy();\n        }\n    },\n    start() {\n\n    },\n    /* 展示poker */\n    showPokers(cards, type) {\n        let startx = cards.length / 2; //开始x坐标\n\n        for (let i = 0; i < cards.length; i++) {\n\n            let pokerSprite = cards[i];\n            //存储Poker节点\n            this._pokerSpriteList.push(pokerSprite);\n\n            // var Poker = pokerSprite.getComponent('Poker');\n            this.node.addChild(pokerSprite);\n            if (type == 0) {\n                let gap = 18; //牌间隙\n                pokerSprite.scale = 0.8;\n                let x = (-startx) * gap + i * gap + gap / 2;\n                // console.log(x);\n                pokerSprite.setPosition(-150 + x, 0);\n            } else if (type == 1) {\n                let gap = 18; //牌间隙\n                pokerSprite.scale = 0.8;\n                let x = (-startx) * gap + i * gap + gap / 2;\n                // console.log(x);\n                pokerSprite.setPosition(150 + x, 0);\n            } else if (type == 3) {\n                let gap = 80; //牌间隙\n                pokerSprite.scale = 0.5;\n                let x = (-startx) * gap + gap / 2 + i * gap;\n                // console.log(x);\n                pokerSprite.setPosition(x, 0);\n            } else if (type == 4) {\n                let gap = 12; //牌间隙\n                pokerSprite.scale = 0.6;\n                let x = (-startx) * gap + gap / 2 + i * gap;\n                // console.log(x);\n                pokerSprite.setPosition(x, 0);\n            } else {\n                let gap = 25; //牌间隙\n                pokerSprite.scale = 1;\n                let x = (-startx) * gap + i * gap + gap / 2;\n                // console.log(x);\n                pokerSprite.setPosition(x, 0);\n            }\n\n        }\n\n    },\n    //点击事件\n\n    /**\n     * 收起所有牌\n     */\n    pokerAllDown() {\n        for (let i in this._pokerSpriteList) {\n            let pokerSprite = this._pokerSpriteList[i];\n            if (pokerSprite.status === POSITION_UP)\n                pokerSprite.y -= 20;\n\n            pokerSprite.status = POSITION_DOWN;\n            pokerSprite.isChiose = false;\n            // pokerSprite.opacity = 255;\n            pokerSprite.color = new cc.color(255,255,255);\n\n            Global.selectPokers = [];\n        }\n    },\n\n    //点击到牌\n    _getCardForTouch(touch) {\n        for (let i = this._pokerSpriteList.length - 1; i >= 0; i--) { // 需要倒序\n            let pokerSprite = this._pokerSpriteList[i];\n            //全屏坐标系\n            let box = pokerSprite.getBoundingBoxToWorld();\n            if (cc.rectContainsPoint(box, touch)) {\n                console.log('in');\n                pokerSprite.isChiose = true;\n                pokerSprite.color = new cc.color(200,200,200);\n                \n                // pokerSprite.opacity = 185;\n                return; //关键， 找到一个就返回\n            }else{\n                //this.pokerAllDown();\n            }\n            \n        }\n    },\n\n    //检测牌复原\n    _checkSelectCardReserve(touchBegan, touchMoved) {\n        // console.log('_checkSelectCardReserve');\n        let p1 = touchBegan.x < touchMoved.x ? touchBegan : touchMoved;\n\n        if (p1 === touchMoved) {\n            // for (let i = this._pokerSpriteList.length - 1; i >= 0; i--) {\n            for (let i in this._pokerSpriteList) {\n                let sprite = this._pokerSpriteList[i];\n                if (p1.x - sprite.x > -25) { //\n                    pokerSprite.color = new cc.color(255,255,255);\n                    // sprite.opacity = 255;\n                    sprite.isChiose = false;\n                }\n            }\n        } else {\n            let width = Math.abs(touchBegan.x - touchMoved.x);\n            let height = Math.abs(touchBegan.y - touchMoved.y) > 5 ? Math.abs(touchBegan.y - touchMoved.y) : 5;\n            let rect = cc.rect(p1.x, p1.y, width, height);\n\n            for (let i = 0; i < this._pokerSpriteList.length; i++) {\n                if (!cc.rectIntersectsRect(this._pokerSpriteList[i].getBoundingBoxToWorld(), rect)) {\n                    this._pokerSpriteList[i].isChiose = false;\n                    pokerSprite.color = new cc.color(255,255,255);\n                    // this._pokerSpriteList[i].opacity = 255;\n                }\n            }\n        }\n\n    },\n/**\n * \n * @param {点击事件} event \n */\n    startCallback(event) {\n        // console.log(touchLoc.x + \",\" + touchLoc.y)\n        let touches = event.getTouches();\n        let touchLoc = touches[0].getLocation();\n        console.log(\"start:\" + touchLoc.x + \",\" + touchLoc.y)\n        this._touchStart = this.node.convertToNodeSpace(touchLoc); //将坐标转换为当前节点坐标\n        // console.log(this._touchStart.x + \",\" + this._touchStart.y)\n        this._getCardForTouch(this._touchStart);\n    },\n\n\n    moveCallback(event) {\n        let touches = event.getTouches();\n        let touchLoc = touches[0].getLocation();\n        console.log(\"move:\" + touchLoc.x + \",\" + touchLoc.y)\n        this._touchMove = this.node.convertToNodeSpace(touchLoc); //将坐标转换为当前节点坐标\n        this._getCardForTouch(this._touchMove);\n        //当选过头了，往回拖的时候取消选择\n        // this._checkSelectCardReserve(this._touchStart, this._touchMove);\n    },\n\n\n    endCallback(event) {\n        console.log(\"end\")\n\n        for (let i = 0; i < this._pokerSpriteList.length; i++) {\n            let pokerSprite = this._pokerSpriteList[i];\n\n            if (pokerSprite.isChiose) {\n                pokerSprite.isChiose = false;\n                // pokerSprite.opacity = 255;\n                pokerSprite.color = new cc.color(255,255,255);\n                if (pokerSprite.status === POSITION_UP) {\n                    pokerSprite.status = POSITION_DOWN;\n                    pokerSprite.y -= 20;\n\n                    //移除所选牌\n                    let index = -1;\n                    for (let k in Global.selectPokers) {\n                        let selectPoker = Global.selectPokers[k];\n                        //选中的卡牌\n                        var selectCard = selectPoker.getComponent('Poker');\n                        //数组里的卡牌\n                        var card = pokerSprite.getComponent('Poker');\n                        if (selectPoker._imageName == card._imageName)\n                            index = k;\n                    }\n                    if (index != -1)\n                        Global.selectPokers.splice(index, 1);\n                } else {\n                    pokerSprite.status = POSITION_UP;\n                    pokerSprite.y += 20;\n\n                    //添加选择的牌\n                    Global.selectPokers.push(pokerSprite);\n                }\n            }else{\n\n            }\n        }\n    },\n\n    // update (dt) {},\n});"]}