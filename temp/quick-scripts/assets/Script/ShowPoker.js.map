{"version":3,"sources":["ShowPoker.js"],"names":["POSITION_UP","POSITION_DOWN","cc","Class","extends","Component","properties","canTouch","_pokerSpriteList","_touchStart","_touchMove","onLoad","console","log","node","on","startCallback","endCallback","moveCallback","onDestroy","off","Node","EventType","TOUCH_START","TOUCH_END","TOUCH_MOVE","start","showPokers","cards","type","startx","length","i","pokerSprite","push","addChild","gap","scale","x","setPosition","pokerAllDown","status","y","isChiose","color","Global","selectPokers","_getCardForTouch","touch","box","getBoundingBoxToWorld","rectContainsPoint","_checkSelectCardReserve","touchBegan","touchMoved","p1","sprite","width","Math","abs","height","rect","rectIntersectsRect","event","touches","getTouches","touchLoc","getLocation","convertToNodeSpace","index","k","selectPoker","selectCard","getComponent","card","_imageName","splice"],"mappings":"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","file":"ShowPoker.js","sourceRoot":"../../../../assets/Script","sourcesContent":["// Learn cc.Class:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/class.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/class/index.html\n// Learn Attribute:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/reference/attributes.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/reference/attributes/index.html\n// Learn life-cycle callbacks:\n//  - [Chinese] http://www.cocos.com/docs/creator/scripting/life-cycle-callbacks.html\n//  - [English] http://www.cocos2d-x.org/docs/editors_and_tools/creator-chapters/scripting/life-cycle-callbacks/index.html\nconst POSITION_UP = 1;\nconst POSITION_DOWN = 2;\ncc.Class({\n    extends: cc.Component,\n\n    properties: {\n        canTouch: false,\n        _pokerSpriteList: null,\n        _touchStart: null,\n        _touchMove: null,\n    },\n\n    // use this for initialization\n    onLoad() {\n        console.log('mynode on load.');\n        if (this.canTouch) {\n            this.node.on('touchstart', this.startCallback, this);\n            this.node.on('touchend', this.endCallback, this);\n            this.node.on('touchmove', this.moveCallback, this);\n        }\n        this._pokerSpriteList = [];\n    },\n\n    onDestroy() {\n        this.node.off(cc.Node.EventType.TOUCH_START, this.startCallback, this);\n        this.node.off(cc.Node.EventType.TOUCH_END, this.endCallback, this);\n        this.node.off(cc.Node.EventType.TOUCH_MOVE, this.moveCallback, this);\n    },\n\n    start() {\n\n    },\n    //展示Poker\n    showPokers(cards, type) {\n        let startx = cards.length / 2; //开始x坐标\n\n        for (let i = 0; i < cards.length; i++) {\n\n            let pokerSprite = cards[i];\n            //存储Poker节点\n            this._pokerSpriteList.push(pokerSprite);\n\n            // var Poker = pokerSprite.getComponent('Poker');\n            this.node.addChild(pokerSprite);\n            if (type == 0) {\n                let gap = 18; //牌间隙\n                pokerSprite.scale = 0.8;\n                let x = (-startx) * gap + i * gap + gap / 2;\n                // console.log(x);\n                pokerSprite.setPosition(-150 + x, 0);\n            } else if (type == 1) {\n                let gap = 18; //牌间隙\n                pokerSprite.scale = 0.8;\n                let x = (-startx) * gap + i * gap + gap / 2;\n                // console.log(x);\n                pokerSprite.setPosition(150 + x, 0);\n            } else if (type == 3) {\n                let gap = 80; //牌间隙\n                pokerSprite.scale = 0.5;\n                let x = (-startx) * gap + gap / 2 + i * gap;\n                // console.log(x);\n                pokerSprite.setPosition(x, 0);\n            } else if (type == 4) {\n                let gap = 12; //牌间隙\n                pokerSprite.scale = 0.6;\n                let x = (-startx) * gap + gap / 2 + i * gap;\n                // console.log(x);\n                pokerSprite.setPosition(x, 0);\n            } else {\n                let gap = 25; //牌间隙\n                pokerSprite.scale = 1;\n                let x = (-startx) * gap + i * gap + gap / 2;\n                // console.log(x);\n                pokerSprite.setPosition(x, 0);\n            }\n\n        }\n\n    },\n    //点击事件\n\n    //倒牌\n    pokerAllDown() {\n        for (let i in this._pokerSpriteList) {\n            let pokerSprite = this._pokerSpriteList[i];\n            if (pokerSprite.status === POSITION_UP)\n                pokerSprite.y -= 20;\n\n            pokerSprite.status = POSITION_DOWN;\n            pokerSprite.isChiose = false;\n            // pokerSprite.opacity = 255;\n            pokerSprite.color = new cc.color(255,255,255);\n\n            Global.selectPokers = [];\n        }\n    },\n\n    //点击到牌\n    _getCardForTouch(touch) {\n        for (let i = this._pokerSpriteList.length - 1; i >= 0; i--) { // 需要倒序\n            let pokerSprite = this._pokerSpriteList[i];\n            //全屏坐标系\n            let box = pokerSprite.getBoundingBoxToWorld();\n            if (cc.rectContainsPoint(box, touch)) {\n                console.log('in');\n                pokerSprite.isChiose = true;\n                pokerSprite.color = new cc.color(200,200,200);\n                \n                // pokerSprite.opacity = 185;\n                return; //关键， 找到一个就返回\n            }else{\n                //this.pokerAllDown();\n            }\n            \n        }\n    },\n\n    //检测牌复原\n    _checkSelectCardReserve(touchBegan, touchMoved) {\n        // console.log('_checkSelectCardReserve');\n        let p1 = touchBegan.x < touchMoved.x ? touchBegan : touchMoved;\n\n        if (p1 === touchMoved) {\n            // for (let i = this._pokerSpriteList.length - 1; i >= 0; i--) {\n            for (let i in this._pokerSpriteList) {\n                let sprite = this._pokerSpriteList[i];\n                if (p1.x - sprite.x > -25) { //\n                    pokerSprite.color = new cc.color(255,255,255);\n                    // sprite.opacity = 255;\n                    sprite.isChiose = false;\n                }\n            }\n        } else {\n            let width = Math.abs(touchBegan.x - touchMoved.x);\n            let height = Math.abs(touchBegan.y - touchMoved.y) > 5 ? Math.abs(touchBegan.y - touchMoved.y) : 5;\n            let rect = cc.rect(p1.x, p1.y, width, height);\n\n            for (let i = 0; i < this._pokerSpriteList.length; i++) {\n                if (!cc.rectIntersectsRect(this._pokerSpriteList[i].getBoundingBoxToWorld(), rect)) {\n                    this._pokerSpriteList[i].isChiose = false;\n                    pokerSprite.color = new cc.color(255,255,255);\n                    // this._pokerSpriteList[i].opacity = 255;\n                }\n            }\n        }\n\n    },\n\n    startCallback(event) {\n        // console.log(touchLoc.x + \",\" + touchLoc.y)\n        let touches = event.getTouches();\n        let touchLoc = touches[0].getLocation();\n        console.log(\"start:\" + touchLoc.x + \",\" + touchLoc.y)\n        this._touchStart = this.node.convertToNodeSpace(touchLoc); //将坐标转换为当前节点坐标\n        // console.log(this._touchStart.x + \",\" + this._touchStart.y)\n        this._getCardForTouch(this._touchStart);\n    },\n\n\n    moveCallback(event) {\n        let touches = event.getTouches();\n        let touchLoc = touches[0].getLocation();\n        console.log(\"move:\" + touchLoc.x + \",\" + touchLoc.y)\n        this._touchMove = this.node.convertToNodeSpace(touchLoc); //将坐标转换为当前节点坐标\n        this._getCardForTouch(this._touchMove);\n        //当选过头了，往回拖的时候取消选择\n        // this._checkSelectCardReserve(this._touchStart, this._touchMove);\n    },\n\n\n    endCallback(event) {\n        console.log(\"end\")\n\n        for (let i = 0; i < this._pokerSpriteList.length; i++) {\n            let pokerSprite = this._pokerSpriteList[i];\n\n            if (pokerSprite.isChiose) {\n                pokerSprite.isChiose = false;\n                // pokerSprite.opacity = 255;\n                pokerSprite.color = new cc.color(255,255,255);\n                if (pokerSprite.status === POSITION_UP) {\n                    pokerSprite.status = POSITION_DOWN;\n                    pokerSprite.y -= 20;\n\n                    //移除所选牌\n                    let index = -1;\n                    for (let k in Global.selectPokers) {\n                        let selectPoker = Global.selectPokers[k];\n                        //选中的卡牌\n                        var selectCard = selectPoker.getComponent('Poker');\n                        //数组里的卡牌\n                        var card = pokerSprite.getComponent('Poker');\n                        if (selectPoker._imageName == card._imageName)\n                            index = k;\n                    }\n                    if (index != -1)\n                        Global.selectPokers.splice(index, 1);\n                } else {\n                    pokerSprite.status = POSITION_UP;\n                    pokerSprite.y += 20;\n\n                    //添加选择的牌\n                    Global.selectPokers.push(pokerSprite);\n                }\n            }else{\n\n            }\n        }\n    },\n\n    // update (dt) {},\n});"]}